<!doctype html>
<html lang="de">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>TH K√∂ln - Leistungsbeschreibung Generator</title>
        <style>
            :root {
                --primary: #0066cc;
                --secondary: #f8f9fa;
                --border: #ddd;
                --header-grey: #f2f2f2;
            }

            * {
                box-sizing: border-box;
            }

            body {
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                margin: 0;
                padding: 0;
                background-color: #f5f5f5;
                line-height: 1.5;
            }

            header {
                background: var(--primary);
                color: white;
                padding: 15px 20px;
                margin-bottom: 20px;
            }

            header h1 {
                margin: 0;
                font-size: 1.5rem;
            }

            .layout {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                max-width: 1400px;
                margin: 0 auto;
                padding: 0 20px;
            }

            .editor-col {
                background: white;
                border-radius: 8px;
                padding: 20px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                max-height: 80vh;
                overflow-y: auto;
            }

            .preview-col {
                background: white;
                border-radius: 8px;
                padding: 20px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            }

            #pageContainer {
                max-height: 80vh;
                overflow-y: auto;
                border: 1px solid var(--border);
            }

            .document-page {
                background: white;
                padding: 25mm;
                margin-bottom: 10px;
                min-height: 297mm;
                width: 210mm;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
                position: relative;
                font-size: 10pt;
                line-height: 1.4;
            }

            .page-number {
                position: absolute;
                bottom: 15mm;
                right: 25mm;
                font-size: 9pt;
                color: #666;
            }

            .card {
                background: white;
                border: 1px solid var(--border);
                border-radius: 6px;
                margin-bottom: 15px;
                overflow: hidden;
            }

            .card-header {
                background: var(--secondary);
                padding: 12px 15px;
                font-weight: bold;
                border-bottom: 1px solid var(--border);
                color: var(--primary);
            }

            .card-header + * {
                padding: 15px;
            }

            label {
                display: block;
                margin-bottom: 5px;
                font-weight: 500;
                color: #333;
            }

            input,
            select,
            textarea {
                width: 100%;
                padding: 8px;
                border: 1px solid var(--border);
                border-radius: 4px;
                font-size: 14px;
                margin-bottom: 10px;
            }

            textarea {
                min-height: 80px;
                resize: vertical;
            }

            .btn {
                background: var(--primary);
                color: white;
                border: none;
                padding: 10px 15px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
            }

            .btn:hover {
                background: #0052a3;
            }

            .btn-add {
                background: #28a745;
                margin-bottom: 10px;
            }

            .btn-del {
                background: #dc3545;
                color: white;
                border: none;
                padding: 5px 8px;
                border-radius: 3px;
                cursor: pointer;
                font-size: 12px;
            }

            .alert {
                background: #fff3cd;
                border: 1px solid #ffeaa7;
                color: #856404;
                padding: 10px;
                border-radius: 4px;
                margin-bottom: 15px;
                display: none;
            }

            .alert-error {
                background: #f8d7da;
                border-color: #f5c6cb;
                color: #721c24;
            }

            .document-page h1 {
                font-family: "Arial", sans-serif;
                font-size: 16pt;
                margin-top: 0;
                margin-bottom: 16pt;
                text-align: center;
                font-weight: bold;
            }

            .document-page h2 {
                font-family: "Arial", sans-serif;
                font-size: 12pt;
                margin-top: 16pt;
                margin-bottom: 8pt;
                font-weight: bold;
                color: #000;
            }

            .document-page h3 {
                font-family: "Arial", sans-serif;
                font-size: 11pt;
                margin-top: 12pt;
                margin-bottom: 6pt;
                font-weight: bold;
                font-style: italic;
            }

            .document-page p {
                font-family: "Arial", sans-serif;
                font-size: 10pt;
                margin-bottom: 8pt;
                text-align: justify;
                line-height: 1.4;
            }

            .document-page table {
                font-family: "Arial", sans-serif;
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 10pt;
                font-size: 10pt;
                table-layout: fixed;
            }

            .document-page th,
            .document-page td {
                font-family: "Arial", sans-serif;
                border: 1px solid #000;
                padding: 6pt;
                vertical-align: top;
                word-wrap: break-word;
                overflow-wrap: anywhere;
                word-break: break-word;
                font-size: 10pt;
                line-height: 1.4;
                hyphens: auto;
                max-width: 0;
                white-space: normal;
            }

            .document-page th {
                background-color: var(--header-grey);
                font-weight: bold;
                text-align: left;
            }

            .grid-2 {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }

            .action-row {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
                margin-top: 20px;
            }

            #error-box {
                display: none;
            }
        </style>
    </head>
    <body>
        <header>
            <h1>
                <span style="font-weight: normal">TH K√∂ln</span>
                Leistungsbeschreibung Generator
            </h1>
        </header>

        <div class="layout">
            <div class="editor-col">
                <div id="error-box" class="alert alert-error"></div>

                <div class="card">
                    <div class="card-header">1. Grundkonfiguration</div>
                    <div style="padding: 15px">
                        <label>Kategorie</label>
                        <select id="catSelect" onchange="setConfig()">
                            <option value="bau">Bauleistung</option>
                            <option value="dienst">Dienstleistung</option>
                            <option value="it">IT / Software</option>
                        </select>

                        <div class="grid-2">
                            <div>
                                <label>Vertragsart</label>
                                <select id="conSelect" onchange="setConfig()">
                                    <option value="einzel">
                                        Einzelauftrag
                                    </option>
                                    <option value="rahmen">
                                        Rahmenvertrag
                                    </option>
                                </select>
                            </div>
                            <div>
                                <label>Projekttitel</label>
                                <input
                                    id="title"
                                    placeholder="Name des Projekts"
                                    oninput="render()"
                                />
                            </div>
                        </div>

                        <label>Vergabenummer</label>
                        <input
                            id="vergbeNr"
                            placeholder="z.B. 2024-001"
                            oninput="render()"
                        />

                        <div class="alert" id="alert-it">
                            <strong>IT-Hinweis:</strong> Bei IT-Beschaffungen
                            gelten besondere Regelungen.
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">2. Beschreibung</div>
                    <div style="padding: 15px">
                        <label>Ist-Zustand (Punkt 1)</label>
                        <textarea
                            id="txt_1"
                            placeholder="Beschreibung der aktuellen Situation..."
                            oninput="render()"
                        ></textarea>

                        <label>Leistungszeitraum</label>
                        <input
                            id="txt_time"
                            value="Nach Vereinbarung"
                            oninput="render()"
                        />

                        <label>Ziel-Zustand (Punkt 3)</label>
                        <textarea
                            id="txt_2"
                            placeholder="Beschreibung des gew√ºnschten Ergebnisses..."
                            oninput="render()"
                        ></textarea>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">3. Anforderungen an Bieter</div>
                    <div style="padding: 15px">
                        <div id="container_bieter"></div>
                        <button class="btn btn-add" onclick="addItem('bieter')">
                            + Anforderung hinzuf√ºgen
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">4. Technische Anforderungen</div>
                    <div style="padding: 15px">
                        <div id="container_leistung"></div>
                        <button
                            class="btn btn-add"
                            onclick="addItem('leistung')"
                        >
                            + Anforderung hinzuf√ºgen
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">5. Kosten und Preise</div>
                    <div style="padding: 15px">
                        <div id="container_preise"></div>
                        <button class="btn btn-add" onclick="addItem('preise')">
                            + Position hinzuf√ºgen
                        </button>
                        <label>Zahlungsziel</label>
                        <input
                            id="pay_terms"
                            value="30 Tage netto"
                            oninput="render()"
                        />
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">6. Zuschlagskriterien</div>
                    <div style="padding: 15px">
                        <label>Wie wird gewertet?</label>
                        <select id="wertungSelect" onchange="render()">
                            <option value="100% Preis (Niedrigster Preis)">
                                100% Preis (Niedrigster Preis gewinnt)
                            </option>
                            <option value="70% Preis / 30% Qualit√§t">
                                70% Preis / 30% Qualit√§t
                            </option>
                            <option value="60% Preis / 40% Konzept">
                                60% Preis / 40% Konzept
                            </option>
                        </select>
                        <label>Detailbeschreibung der Zuschlagskriterien</label>
                        <textarea
                            id="txt_zuschlag"
                            rows="4"
                            oninput="
                                data.zuschlagskriterien = this.value;
                                render();
                            "
                            placeholder="Die Zuschlagserteilung erfolgt nach..."
                        ></textarea>
                    </div>
                </div>

                <div class="card" id="card-rahmen" style="display: none">
                    <div class="card-header">
                        7. Sonstige Regelungen zur Rahmenvereinbarung
                    </div>
                    <div style="padding: 15px">
                        <label>Regelungen zu Abrufen und Auftragsvolumen</label>
                        <textarea
                            id="txt_rahmen"
                            rows="6"
                            oninput="
                                data.rahmenRegelungen = this.value;
                                render();
                            "
                            placeholder="5.1 Abrufe: Einzelauftr√§ge..."
                        ></textarea>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        7./8. Vertrags- und Vergabebedingungen
                    </div>
                    <div style="padding: 15px">
                        <label>Geltende Bestimmungen und Regelungen</label>
                        <textarea
                            id="txt_vertrags"
                            rows="3"
                            oninput="
                                data.vertragsBedingungen = this.value;
                                render();
                            "
                            placeholder="Es gelten die [LEGAL] sowie die AGB der TH K√∂ln..."
                        ></textarea>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        8./9. Mitgeltende Dokumente / Anlagen
                    </div>
                    <div style="padding: 15px">
                        <label>Anlagen und Dokumente</label>
                        <textarea
                            id="txt_anlagen"
                            rows="3"
                            oninput="
                                data.anlagen = this.value;
                                render();
                            "
                            placeholder="Keine Anlagen."
                        ></textarea>
                    </div>
                </div>

                <div class="action-row">
                    <button class="btn" onclick="exportPDF()">
                        üìÑ PDF Vorschau
                    </button>
                    <button
                        class="btn"
                        style="background: #a00; color: white; border: none"
                        onclick="exportWord()"
                    >
                        üíæ Word Export
                    </button>
                </div>
            </div>

            <div class="preview-col">
                <div id="pageContainer">
                    <div class="document-page">
                        <p>Bitte w√§hlen Sie eine Kategorie aus...</p>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://unpkg.com/docx@8.5.0/build/index.js"></script>
        <script src="https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js"></script>
        <script src="https://unpkg.com/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>

        <script>
            const DEFAULTS = {
                bau: {
                    t1: "Die TH K√∂ln hat Bedarf an [Gewerk] f√ºr den Gesamtbereich der Technischen Hochschule K√∂ln. Die betreffenden R√§ume weisen starken Sanierungsbedarf auf.",
                    t2: "Leistungsgegenstand ist die Ausf√ºhrung von Arbeiten gem. dem Standardleistungsbuch (StLB) f√ºr das Bauwesen.\nProduktbedingte Abweichungen der Ma√üe sind mit den Einheitspreisen abgegolten.",
                    rows: [
                        {
                            text: "Verarbeitungstemperatur min. 5 Grad Celsius",
                            reason: "Herstellervorgabe / Qualit√§t",
                            crit: "A",
                            we: "-",
                        },
                        {
                            text: "Untergrundvorbereitung gem. VOB Teil C",
                            reason: "Normerf√ºllung",
                            crit: "A",
                            we: "-",
                        },
                        {
                            text: "Entsorgung der Altmaterialien und Bauschutt",
                            reason: "Umweltschutz",
                            crit: "B",
                            we: "-",
                        },
                    ],
                },
                dienst: {
                    t1: "Die TH K√∂ln ben√∂tigt Unterst√ºtzung im Bereich [Bereich]. Derzeit wird die Leistung intern / nicht erbracht.",
                    t2: "Ziel ist die Sicherstellung der Leistung gem√§√ü den beiliegenden Qualit√§tsstandards.",
                    rows: [
                        {
                            text: "Reaktionszeit bei St√∂rungen < 4 Stunden",
                            reason: "Betriebssicherheit",
                            crit: "A",
                            we: "-",
                        },
                        {
                            text: "Erreichbarkeit Werktags 07:00 - 17:00 Uhr",
                            reason: "Kernarbeitszeit",
                            crit: "A",
                            we: "-",
                        },
                        {
                            text: "Einsatz von geschultem Fachpersonal",
                            reason: "Qualit√§tssicherung",
                            crit: "B",
                            we: "20%",
                        },
                    ],
                },
                it: {
                    t1: "Die bestehende L√∂sung [Systemname] entspricht nicht mehr den aktuellen Sicherheitsanforderungen.",
                    t2: "Beschaffung und Implementierung einer neuen Softwarel√∂sung inkl. Migration der Bestandsdaten.",
                    rows: [
                        {
                            text: "Serverstandort Deutschland / EU (DSGVO Konform)",
                            reason: "Datenschutz",
                            crit: "A",
                            we: "-",
                        },
                        {
                            text: "Barrierefreiheit nach BITV 2.0",
                            reason: "Gesetzl. Vorgabe",
                            crit: "A",
                            we: "-",
                        },
                        {
                            text: "Schnittstellen zu SAP vorhanden",
                            reason: "Integration",
                            crit: "A",
                            we: "-",
                        },
                    ],
                },
            };

            const BIETER_STD = [
                {
                    krit: "Fachkunde",
                    text: "Stellen Sie auf dem Formblatt ‚ÄûUnternehmensdaten" kurz Ihr Unternehmen vor und gehen dabei mindestens auf die dort vorgegebenen Punkte ein.",
                },
                {
                    krit: "Wirtschaftliche Leistungsf√§higkeit",
                    text: "Geben Sie auf dem Formblatt ‚ÄûUnternehmensdaten" ihre Daten zu einer Industriehaftpflichtversicherung an. Der Auftragnehmer weist auf Verlangen des Auftraggebers nach, dass er √ºber eine im Rahmen und Umfang markt√ºbliche Industriehaftpflichtversicherung oder eine vergleichbare Versicherung aus einem Mitgliedsstaat der EU verf√ºgt.",
                },
                {
                    krit: "Technische Leistungsf√§higkeit",
                    text: "Geben Sie auf dem Formblatt ‚ÄûReferenzliste" mindestens einen Referenzkunden, mit der konkret zu vergebenen Leistung vergleichbarer Gr√∂√üe an. Es gelten die Datenschutzbestimmungen der EU-Datenschutzgrundverordnung (EU-DS-GVO). Die Referenzen werden durch die TH K√∂ln vertraulich behandelt und nur zu Zwecken der Referenzpr√ºfung genutzt. Die Nicht-Vorlage von Referenzen f√ºhrt zum Ausschluss aus dem Vergabeverfahren.",
                },
                {
                    krit: "Zuverl√§ssigkeit",
                    text: "Mit der Abgabe des Angebotes best√§tigen Sie Ihre Unterschrift unter die in den Anlagen: ‚Ä¢ Eigenerkl√§rung zu Ausschlussgr√ºnden, Formular 521 ‚Ä¢ Eigenerkl√§rung Mindestlohngesetz, Formular 522 ‚Ä¢ Zus√§tzliche Vertragsbedingungen, Formular 512 ‚Ä¢ Besondere Vertragsbedingungen TVgG-NRW, Formular 513 Bei Bietergemeinschaften: ‚Ä¢ unterschriebene Bietergemeinschaftserkl√§rung, Formular 531 Bei Unterauftr√§gen/Eignungsleihe: ‚Ä¢ Erkl√§rung Bieter Unterauftr√§ge/Eignungsleihe, Formular 532 und ‚Ä¢ bei Eignungsleihe zus√§tzlich unterschriebene Verpflichtungserkl√§rung Dritter Unterauftr√§ge/Eignungsleihe, Formular 533.",
                },
            ];

            let data = {
                cat: "bau",
                con: "einzel",
                bieter: JSON.parse(JSON.stringify(BIETER_STD)),
                leistung: [],
                preise: [
                    {
                        text: "Baustelleneinrichtung / Anfahrt",
                        menge: "1",
                        einheit: "psch",
                        preis: "",
                    },
                ],
                zuschlagskriterien: "Die Zuschlagserteilung erfolgt nach dem Kriterium des niedrigsten Preises. Bewertung erfolgt anhand des Gesamtpreises aller Positionen.",
                rahmenRegelungen: "5.1 Abrufe: Einzelauftr√§ge\nDer Leistungsabruf erfolgt schriftlich.\n\n5.2 Auftragsvolumen\nDie Mengen sind Sch√§tzwerte ohne Abnahmeverpflichtung.",
                vertragsBedingungen: "Es gelten die [LEGAL] sowie die AGB der TH K√∂ln. Eigene AGB des Auftragnehmers sind ausgeschlossen.",
                anlagen: "Keine Anlagen.",
            };

            function init() {
                try {
                    setConfig();
                } catch (e) {
                    showError("Fehler beim Starten: " + e.message);
                }
            }

            function showError(msg) {
                const errBox = document.getElementById("error-box");
                errBox.innerText = msg;
                errBox.style.display = "block";
            }

            function setConfig() {
                try {
                    data.cat = document.getElementById("catSelect").value;
                    data.con = document.getElementById("conSelect").value;
                    const def = DEFAULTS[data.cat];

                    document.getElementById("alert-it").style.display = data.cat === "it" ? "block" : "none";
                    document.getElementById("card-rahmen").style.display = data.con === "rahmen" ? "block" : "none";

                    const f1 = document.getElementById("txt_1");
                    const f2 = document.getElementById("txt_2");
                    if (f1.value.length < 10 || f1.value.includes("TH K√∂ln")) {
                        f1.value = def.t1;
                        f2.value = def.t2;
                        data.leistung = JSON.parse(JSON.stringify(def.rows));
                    }

                    document.getElementById("txt_zuschlag").value = data.zuschlagskriterien;
                    document.getElementById("txt_rahmen").value = data.rahmenRegelungen;
                    document.getElementById("txt_vertrags").value = data.vertragsBedingungen;
                    document.getElementById("txt_anlagen").value = data.anlagen;

                    renderEditors();
                    render();
                } catch (e) {
                    showError("Fehler beim Konfigurieren: " + e.message);
                }
            }

            function renderEditors() {
                // Bieter Tabelle
                const bCont = document.getElementById("container_bieter");
                bCont.innerHTML = "";
                data.bieter.forEach((row, i) => {
                    const div = document.createElement("div");
                    div.style.cssText = "background:#fcfcfc; padding:10px; margin-bottom:10px; border:1px solid #ddd; border-left:4px solid var(--primary); border-radius:4px;";
                    div.innerHTML = `
                        <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                            <label style="margin:0; color:#333;">Nr. ${i + 1}: ${row.krit}</label>
                            <button class="btn-del" onclick="delItem('bieter', ${i})">L√∂schen</button>
                        </div>
                        <textarea id="b_txt_${i}" style="margin-bottom:5px;">${row.text}</textarea>
                        <input id="b_krit_${i}" value="${row.krit}" placeholder="Kriterium">
                    `;
                    div.querySelector(`#b_txt_${i}`).oninput = (e) => {
                        data.bieter[i].text = e.target.value;
                        render();
                    };
                    div.querySelector(`#b_krit_${i}`).oninput = (e) => {
                        data.bieter[i].krit = e.target.value;
                        renderEditors();
                        render();
                    };
                    bCont.appendChild(div);
                });

                // Leistung Tabelle
                const lCont = document.getElementById("container_leistung");
                lCont.innerHTML = "";
                data.leistung.forEach((row, i) => {
                    const div = document.createElement("div");
                    div.style.cssText = "background:#fcfcfc; padding:10px; margin-bottom:10px; border:1px solid #ddd; border-left:4px solid var(--primary); border-radius:4px;";
                    div.innerHTML = `
                        <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                            <label style="margin:0; color:#333;">Nr. ${i + 1}</label>
                            <button class="btn-del" onclick="delItem('leistung', ${i})">L√∂schen</button>
                        </div>
                        <textarea id="l_txt_${i}" style="margin-bottom:5px;">${row.text}</textarea>
                        <div style="display:grid; grid-template-columns: 2fr 1fr 1fr; gap:5px;">
                            <div><label>Sachgrund</label><input id="l_res_${i}" value="${row.reason}"></div>
                            <div><label>Art</label><select id="l_crit_${i}"><option value="A" ${row.crit === "A" ? "selected" : ""}>A (Muss)</option><option value="B" ${row.crit === "B" ? "selected" : ""}>B (Wahl)</option></select></div>
                            <div><label>Gewicht</label><input id="l_we_${i}" value="${row.we}"></div>
                        </div>
                    `;
                    div.querySelector(`#l_txt_${i}`).oninput = (e) => {
                        data.leistung[i].text = e.target.value;
                        render();
                    };
                    div.querySelector(`#l_res_${i}`).oninput = (e) => {
                        data.leistung[i].reason = e.target.value;
                        render();
                    };
                    div.querySelector(`#l_crit_${i}`).onchange = (e) => {
                        data.leistung[i].crit = e.target.value;
                        render();
                    };
                    div.querySelector(`#l_we_${i}`).oninput = (e) => {
                        data.leistung[i].we = e.target.value;
                        render();
                    };
                    lCont.appendChild(div);
                });

                // Preise Tabelle
                const pCont = document.getElementById("container_preise");
                pCont.innerHTML = "";
                let ph = data.cat === "bau" ? "Leistungstext / StLB-Nr." : "Leistungsbeschreibung";
                data.preise.forEach((row, i) => {
                    const div = document.createElement("div");
                    div.style.cssText = "display:flex; gap:5px; margin-bottom:8px; align-items:center;";
                    div.innerHTML = `
                        <div style="flex:2"><input id="p_txt_${i}" value="${row.text}" placeholder="${ph}"></div>
                        <div style="width:60px"><input id="p_men_${i}" value="${row.menge}" placeholder="Menge"></div>
                        <div style="width:60px"><input id="p_ein_${i}" value="${row.einheit}" placeholder="Einh"></div>
                        <button class="btn-del" onclick="delItem('preise', ${i})">√ó</button>
                    `;
                    div.querySelector(`#p_txt_${i}`).oninput = (e) => {
                        data.preise[i].text = e.target.value;
                        render();
                    };
                    div.querySelector(`#p_men_${i}`).oninput = (e) => {
                        data.preise[i].menge = e.target.value;
                        render();
                    };
                    div.querySelector(`#p_ein_${i}`).oninput = (e) => {
                        data.preise[i].einheit = e.target.value;
                        render();
                    };
                    pCont.appendChild(div);
                });
            }

            function addItem(key) {
                if (key === "bieter") data.bieter.push({
                    krit: "Neues Kriterium",
                    text: "",
                });
                if (key === "leistung") data.leistung.push({
                    text: "",
                    reason: "",
                    crit: "A",
                    we: "",
                });
                if (key === "preise") data.preise.push({
                    text: "",
                    menge: "",
                    einheit: "",
                    preis: "",
                });
                renderEditors();
                render();
            }

            window.delItem = function (key, i) {
                data[key].splice(i, 1);
                renderEditors();
                render();
            };

            function render() {
                try {
                    data.con = document.getElementById("conSelect").value;
                    const title = document.getElementById("title").value || "Projekttitel";
                    const vNr = document.getElementById("vergbeNr").value;

                    let legal = "VOL/B";
                    if (data.cat === "bau") legal = "VOB/B";
                    if (data.cat === "it") legal = "EVB-IT / BGB";

                    let html = `
                        <h1>LEISTUNGSBESCHREIBUNG</h1>

                        <div style="border:1px solid #000; padding:10px; margin-bottom:20px; font-size:10pt; background:#f9f9f9;">
                            <table style="border:none; margin:0;">
                                <tr><td style="border:none; padding:2px;"><b>Projekt:</b></td><td style="border:none; padding:2px;">${title}</td></tr>
                                <tr><td style="border:none; padding:2px;"><b>Vergabenummer:</b></td><td style="border:none; padding:2px;">${vNr}</td></tr>
                            </table>
                        </div>

                        <h2>1 Einf√ºhrung und Ist-Zustand</h2>
                        <p>${document.getElementById("txt_1").value.replace(/\n/g, "<br>")}</p>

                        <h2>2 Leistungszeitraum</h2>
                        <p>${document.getElementById("txt_time").value}</p>

                        <h2>3 Ziel und Soll-Zustand</h2>
                        <p>${document.getElementById("txt_2").value.replace(/\n/g, "<br>")}</p>
                        <p>Es gelten die Bestimmungen der <b>${legal}</b>.</p>

                        <h2>4 Anforderungen</h2>
                        <h3>4.1 Anforderungen an die Eignung des Bieters</h3>
                        <table>
                            <colgroup><col style="width:5%"><col style="width:30%"><col style="width:65%"></colgroup>
                            <tr><th>Nr</th><th>Kriterium</th><th>Anforderung</th></tr>
                            ${data.bieter.map((r, i) => `<tr><td>${i + 1}</td><td>${r.krit}</td><td>${r.text.replace(/\n/g, "<br>")}</td></tr>`).join("")}
                        </table>

                        <h3>4.2 Anforderungen an die Leistung (Technik)</h3>
                        <table>
                            <colgroup><col style="width:5%"><col style="width:35%"><col style="width:30%"><col style="width:15%"><col style="width:15%"></colgroup>
                            <tr><th>Nr.</th><th>Anforderung</th><th style="background-color:#f2f2f2;">Sachgrund</th><th>Krit.</th><th>Gew.</th></tr>
                            ${data.leistung.map((r, i) => `<tr>
                                <td>${i + 1}</td>
                                <td>${r.text.replace(/\n/g, "<br>")}</td>
                                <td style="background-color:#f2f2f2;">${r.reason}</td>
                                <td>${r.crit}</td>
                                <td>${r.we}</td>
                            </tr>`).join("")}
                        </table>

                        <h2>5 Kosten und Preise</h2>
                        <table>
                            <colgroup><col style="width:5%"><col style="width:50%"><col style="width:15%"><col style="width:10%"><col style="width:20%"></colgroup>
                            <tr><th>Pos</th><th>${data.cat === "bau" ? "Leistung / StLB-Nr." : "Leistungsbeschreibung"}</th><th>Menge</th><th>Einh</th><th>Preis (netto)</th></tr>
                            ${data.preise.map((r, i) => `<tr><td>${i + 1}</td><td>${r.text}</td><td>${r.menge}</td><td>${r.einheit}</td><td>________ ‚Ç¨</td></tr>`).join("")}
                        </table>
                        <p>Zahlung: ${document.getElementById("pay_terms").value}</p>

                        <h2>6 Zuschlagskriterien</h2>
                        <p>Bewertungsverfahren: <b>${document.getElementById("wertungSelect").value}</b></p>
                        <p>${data.zuschlagskriterien.replace(/\n/g, "<br>")}</p>
                    `;

                    if (data.con === "rahmen") {
                        html += `
                            <h2>7 Sonstige Regelungen zur Rahmenvereinbarung</h2>
                            <p>${data.rahmenRegelungen.replace(/\n/g, "<br>")}</p>`;
                    }

                    let off = data.con === "rahmen" ? 1 : 0;
                    html += `
                        <h2>${7 + off} Vertrags- und Vergabebedingungen</h2>
                        <p>${data.vertragsBedingungen.replace(/\[LEGAL\]/g, legal).replace(/\n/g, "<br>")}</p>
                        <h2>${8 + off} Mitgeltende Dokumente / Anlagen</h2>
                        <p>${data.anlagen.replace(/\n/g, "<br>")}</p>
                    `;

                    createDocumentPages(html);
                } catch (e) {
                    console.error(e);
                }
            }

            function createDocumentPages(content) {
                const pageContainer = document.getElementById("pageContainer");
                pageContainer.innerHTML = "";

                const pageDiv = document.createElement("div");
                pageDiv.className = "document-page";
                pageDiv.innerHTML = content;

                const pageNumber = document.createElement("div");
                pageNumber.className = "page-number";
                pageNumber.textContent = "Seite 1";
                pageDiv.appendChild(pageNumber);

                pageContainer.appendChild(pageDiv);
            }

            function exportPDF() {
                const element = document.querySelector('.document-page');
                const opt = {
                    margin: 0,
                    filename: 'leistungsbeschreibung.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2 },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                };
                html2pdf().set(opt).from(element).save();
            }

            function exportWord() {
                alert("Word Export - Hier w√ºrde die docx-Datei erstellt werden.");
            }

            window.onload = init;
        </script>
    </body>
</html>
